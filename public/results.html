<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sitemap Processing Results</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        .grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 20px;
        }
        .box {
            border: 1px solid #ccc;
            padding: 10px;
            display: flex;
            flex-direction: column;
        }
        .box img {
            width: 100%;
            height: auto;
            object-fit: contain;
            max-height: 600px;
        }
        .scroll-container {
            max-height: 600px;
            overflow-y: auto;
        }
        .floating-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }
        .popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            z-index: 1001;
        }
        .popup-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen p-8">
    <div class="max-w-full mx-auto">
        <h1 class="text-3xl font-bold mb-8 text-center text-gray-800">Sitemap Processing Results</h1>
        <div id="results" class="grid"></div>
    </div>

    <button id="getInfoButton" class="floating-button bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
        Get Info
    </button>

    <div id="popupOverlay" class="popup-overlay"></div>
    <div id="popup" class="popup">
        <h2 class="text-xl font-bold mb-4">Project Information</h2>
        <p id="customCount"></p>
        <p id="cmsCount"></p>
        <p id="totalTime"></p>
        <button id="closePopup" class="mt-4 bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded">
            Close
        </button>
    </div>

    <script>
        let crawlData = [];
        const crawlId = new URLSearchParams(window.location.search).get('crawlId');

        async function loadResults() {
            let response;
            if (crawlId) {
                response = await fetch(`/results/${crawlId}`);
            } else {
                response = await fetch('/results.json');
            }
            crawlData = await response.json();
            const resultsContainer = document.getElementById('results');

            // Load saved page types
            const savedPageTypes = JSON.parse(localStorage.getItem(`pageTypes_${crawlId}`) || '{}');

            crawlData.forEach((page, index) => {
                const box = document.createElement('div');
                box.className = 'box bg-white rounded-lg shadow-md overflow-hidden';
                box.innerHTML = `
                    <img src="${page.screenshotPath}" alt="${page.title}" class="mb-4">
                    <div class="scroll-container p-4">
                        <h2 class="text-xl font-semibold text-gray-800 mb-2">${page.title}</h2>
                        <div class="space-y-2 text-sm text-gray-600">
                            <p><span class="font-semibold">URL:</span> ${page.url}</p>
                            <p><span class="font-semibold">Description:</span> ${page.description || 'N/A'}</p>
                            <p><span class="font-semibold">Keywords:</span> ${page.keywords || 'N/A'}</p>
                            <p><span class="font-semibold">H1:</span> ${page.h1 || 'N/A'}</p>
                            <p><span class="font-semibold">Canonical URL:</span> ${page.canonicalUrl || 'N/A'}</p>
                            <details>
                                <summary class="font-semibold cursor-pointer">Open Graph Data</summary>
                                <p><span class="font-semibold">Title:</span> ${page.ogTitle || 'N/A'}</p>
                                <p><span class="font-semibold">Description:</span> ${page.ogDescription || 'N/A'}</p>
                                <p><span class="font-semibold">Image:</span> ${page.ogImage || 'N/A'}</p>
                            </details>
                            <details>
                                <summary class="font-semibold cursor-pointer">Twitter Card Data</summary>
                                <p><span class="font-semibold">Card:</span> ${page.twitterCard || 'N/A'}</p>
                                <p><span class="font-semibold">Title:</span> ${page.twitterTitle || 'N/A'}</p>
                                <p><span class="font-semibold">Description:</span> ${page.twitterDescription || 'N/A'}</p>
                                <p><span class="font-semibold">Image:</span> ${page.twitterImage || 'N/A'}</p>
                            </details>
                        </div>
                    </div>
                    <div class="p-4 bg-gray-100">
                        <p class="font-semibold mb-2">Page Type:</p>
                        <label class="inline-flex items-center mr-4">
                            <input type="radio" class="form-radio" name="pageType${index}" value="custom" data-index="${index}" ${savedPageTypes[page.url] === 'custom' ? 'checked' : ''}>
                            <span class="ml-2">Custom</span>
                        </label>
                        <label class="inline-flex items-center mr-4">
                            <input type="radio" class="form-radio" name="pageType${index}" value="cms" data-index="${index}" ${savedPageTypes[page.url] === 'cms' ? 'checked' : ''}>
                            <span class="ml-2">CMS</span>
                        </label>
                        <label class="inline-flex items-center">
                            <input type="radio" class="form-radio" name="pageType${index}" value="na" data-index="${index}" ${!savedPageTypes[page.url] || savedPageTypes[page.url] === 'na' ? 'checked' : ''}>
                            <span class="ml-2">N/A</span>
                        </label>
                    </div>
                    <a href="${page.url}" target="_blank" class="block bg-indigo-600 text-white py-2 px-4 text-center hover:bg-indigo-700 transition duration-300">Visit Page</a>
                `;
                resultsContainer.appendChild(box);
            });

            // Add event listeners for radio buttons
            document.querySelectorAll('input[type="radio"]').forEach(radio => {
                radio.addEventListener('change', (e) => {
                    const index = e.target.dataset.index;
                    const value = e.target.value;
                    const url = crawlData[index].url;
                    savedPageTypes[url] = value;
                    localStorage.setItem(`pageTypes_${crawlId}`, JSON.stringify(savedPageTypes));
                });
            });
        }

        loadResults();

        // Get Info functionality
        const getInfoButton = document.getElementById('getInfoButton');
        const popup = document.getElementById('popup');
        const popupOverlay = document.getElementById('popupOverlay');
        const closePopup = document.getElementById('closePopup');

        getInfoButton.addEventListener('click', () => {
            let customCount = 0;
            let cmsCount = 0;

            const savedPageTypes = JSON.parse(localStorage.getItem(`pageTypes_${crawlId}`) || '{}');

            Object.values(savedPageTypes).forEach(pageType => {
                if (pageType === 'custom') customCount++;
                if (pageType === 'cms') cmsCount++;
            });

            const totalMinutes = (customCount * 30) + (cmsCount * 10);
            const totalHours = (totalMinutes / 60).toFixed(2);

            document.getElementById('customCount').textContent = `Custom pages: ${customCount}`;
            document.getElementById('cmsCount').textContent = `CMS pages: ${cmsCount}`;
            document.getElementById('totalTime').textContent = `Estimated time: ${totalHours} hours`;

            popup.style.display = 'block';
            popupOverlay.style.display = 'block';
            popup.classList.add('animate-fade-in-down');
        });

        closePopup.addEventListener('click', () => {
            popup.style.display = 'none';
            popupOverlay.style.display = 'none';
        });

        popupOverlay.addEventListener('click', () => {
            popup.style.display = 'none';
            popupOverlay.style.display = 'none';
        });
    </script>
</body>
</html>